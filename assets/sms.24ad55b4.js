import{n as O,_ as U,r as l,u as B,b as h,o as r,c as u,d as g,w as k,e as d,F as N,f as P,t as b,g as C,h as R,U as V,i as q,p as E,j as F,T as $,a as H}from"./index.9cf8caff.js";import{u as D}from"./debounce.3a849b21.js";import{D as z}from"./dateFormat.340f37ba.js";import{b as G,S as x}from"./api.4e830948.js";const A=O({name:"SmsList",components:{},props:{type:Number},setup(e,{emit:s}){const i=l([]),n=l(""),m=l(!1),f=l(!1),a=l(1),c=l(20),o=l(!1);B();const _=()=>{let p=new Date().getTime(),w={data:{type:e.type,page_num:a.value,page_size:c.value,keyword:n.value},timestamp:p,sign:V.sisgn(p,V.sign())};q.post(G,w).then(M=>{M.data.code===200&&(M.data.data.length>=1?(m.value=!1,i.value.push(...M.data.data)):f.value=!0)})},S=()=>{_(),a.value++},t=(p,w)=>z.format(new Date(p),w),v=p=>z.getTime(p),y=()=>{f.value=!1,m.value=!0,a.value=1,i.value=[],_(),o.value=!1};let L=D("",500,p=>{i.value=[],n.value=p,y()});return{list:i,onLoad:S,loading:m,finished:f,onRefresh:y,refreshing:o,format:t,getTime:v,sendSms:p=>{let w=p.number.replace(/\s+/g,"");s("openSendContent",w,p)},keyword:L,keywords:n,useDebounced:D,getPageList:_,page_num:a,page_size:c}}}),T=e=>(E("data-v-af12148e"),e=e(),F(),e),J={id:"smsList"},K=["onClick"],Q={class:"smsContentInfo"},W={class:"smsContentext"},X={class:"smsContentOtherBtn"},Y={class:"smstime"},Z={key:0,class:"icon sim",style:{color:"#b2e7a7"},"aria-hidden":"true"},ee=T(()=>d("use",{"xlink:href":"#icon-dual-sim-1-line"},null,-1)),ne=[ee],se={key:1,class:"icon sim",style:{color:"#1296db"},"aria-hidden":"true"},te=T(()=>d("use",{"xlink:href":"#icon-dual-sim-2-line"},null,-1)),oe=[te],ae={key:2,class:"icon sim",style:{color:"#75bfdb"},"aria-hidden":"true"},le=T(()=>d("use",{"xlink:href":"#icon-Sim-Card"},null,-1)),ie=[le],de={class:"smsContentSend"},re=["onClick"],ce=T(()=>d("use",{"xlink:href":"#icon-duanxin"},null,-1)),ue=[ce];function me(e,s,i,n,m,f){const a=h("van-search"),c=h("van-image"),o=h("van-list"),_=h("van-empty"),S=h("van-pull-refresh");return r(),u("div",J,[g(a,{modelValue:e.keyword,"onUpdate:modelValue":s[0]||(s[0]=t=>e.keyword=t),placeholder:"\u641C\u7D22\u77ED\u4FE1",shape:"round","clear-trigger":"always"},null,8,["modelValue"]),g(S,{modelValue:e.refreshing,"onUpdate:modelValue":s[2]||(s[2]=t=>e.refreshing=t),onRefresh:e.onRefresh},{default:k(()=>[g(o,{loading:e.loading,"onUpdate:loading":s[1]||(s[1]=t=>e.loading=t),finished:e.finished,"finished-text":e.list.length>0?"\u6CA1\u6709\u66F4\u591A\u4E86":"",onLoad:e.onLoad},{default:k(()=>[d("ul",null,[(r(!0),u(N,null,P(e.list,(t,v)=>(r(),u("li",{class:"smsContentList",key:v},[d("div",{class:"smsContentImgInfo",onClick:y=>e.sendSms(t)},[g(c,{round:"",none:"",width:"2.5rem",height:"2.5rem",src:t.name==="\u672A\u77E5\u53F7\u7801"?"../static/image/sms1.png":`https://ui-avatars.com/api/?name=${t.name}&length=1&background=random&size=58&bold=true&color=ff0000`},null,8,["src"]),d("div",Q,[d("span",null,b(t.name==="\u672A\u77E5\u53F7\u7801"?t.number:t.name),1),d("p",W,b(t.content),1)])],8,K),d("div",X,[d("span",Y,b(e.format(t.date,"MM-dd HH:mm")),1),t.sim_id===0?(r(),u("svg",Z,ne)):C("",!0),t.sim_id===1?(r(),u("svg",se,oe)):C("",!0),t.sim_id===-1?(r(),u("svg",ae,ie)):C("",!0),d("div",de,[(r(),u("svg",{class:"icon sms","aria-hidden":"true",onClick:y=>e.sendSms(t)},ue,8,re))])])]))),128))])]),_:1},8,["loading","finished","finished-text","onLoad"]),e.list.length<=0?(r(),R(_,{key:0,description:"\u6682\u65E0\u6570\u636E"})):C("",!0)]),_:1},8,["modelValue","onRefresh"])])}var _e=U(A,[["render",me],["__scopeId","data-v-af12148e"]]);const pe=O({name:"sendSmsContent",props:{number:String,smsContent:Object,key:Number},setup(e,{emit:s}){const i=l(""),n=l(""),m=l(1),f=l(!1),a=l([]),c=[{text:"SIM1",icon:"/static/image/sim1.png"},{text:"SIM2",icon:"/static/image/sim2.png"}];return e.number&&(i.value=e.number),e.smsContent&&a.value.push(e.smsContent),{phone_numbers:i,msg_content:n,formatter:v=>v.replace(/[^\d+(,\d\d\d)\d+$]/g,""),showPopover:f,actions:c,onSelect:v=>{$(v.text),m.value=v.text==="SIM1"?1:2},sendSms:()=>{if(i.value===""||i.value==="")return;let v=new Date().getTime(),y={data:{sim_slot:m.value,phone_numbers:i.value,msg_content:n.value},timestamp:v,sign:V.sisgn(v,V.sign())};q.post(x,y).then(L=>{if(L.data.code===200){$({message:"\u77ED\u4FE1\u53D1\u9001\u6210\u529F",icon:"/static/image/send-sms-success.png"});const I={content:n.value,type:2};a.value.push(I),setTimeout(()=>{s("close")},2500)}else $({message:"\u77ED\u4FE1\u53D1\u9001\u5931\u8D25",icon:"/static/image/send-sms-fail.png"})})},sim_slot:m,sendList:a,close:()=>{a.value=[],a.value="",i.value=""}}}}),j=e=>(E("data-v-58188fc1"),e=e(),F(),e),ve={class:"sendSmsContent"},he={class:"sendMain"},fe={key:0,id:"zm_6",style:{float:"left"}},ge={key:1,id:"zm_0",style:{float:"right"}},Se=j(()=>d("svg",{class:"icon sim","aria-hidden":"true"},[d("use",{class:"con-SIMqia","xlink:href":"#icon-Simcard"})],-1)),ye=j(()=>d("use",{"xlink:href":"#icon-fasong"},null,-1)),Ce=[ye];function ke(e,s,i,n,m,f){const a=h("van-field"),c=h("van-popover");return r(),u("div",ve,[g(a,{class:"recipient",modelValue:e.phone_numbers,"onUpdate:modelValue":s[0]||(s[0]=o=>e.phone_numbers=o),"label-width":"3.5em",label:"\u6536\u4EF6\u4EBA",autofocus:!0,formatter:e.formatter,round:"",placeholder:"\u8BF7\u8F93\u5165\u6536\u4EF6\u4EBA\u624B\u673A\u53F7,\u5982\u6709\u591A\u4E2A\u53F7\u7801\u8BF7\u7528,\u5206\u5F00"},null,8,["modelValue","formatter"]),d("div",he,[(r(!0),u(N,null,P(e.sendList,(o,_)=>(r(),u("div",{key:_},[o.type===1?(r(),u("div",fe,[d("p",null,b(o.content),1)])):C("",!0),o.type===2?(r(),u("div",ge,[d("p",null,b(o.content),1)])):C("",!0)]))),128))]),g(a,{class:"sendContent",modelValue:e.msg_content,"onUpdate:modelValue":s[3]||(s[3]=o=>e.msg_content=o),rows:"1","label-width":"2.5em",autosize:"",label:"\u5185\u5BB9",maxlength:"70",type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u53D1\u4FE1\u5185\u5BB9"},{button:k(()=>[g(c,{show:e.showPopover,"onUpdate:show":s[1]||(s[1]=o=>e.showPopover=o),actions:e.actions,onSelect:e.onSelect,placement:"top"},{reference:k(()=>[Se]),_:1},8,["show","actions","onSelect"]),(r(),u("svg",{class:"icon send","aria-hidden":"true",onClick:s[2]||(s[2]=(...o)=>e.sendSms&&e.sendSms(...o))},Ce))]),_:1},8,["modelValue"])])}var we=U(pe,[["render",ke],["__scopeId","data-v-58188fc1"]]);const be={name:"SMS",components:{SmsList:_e,SendSmsContent:we},setup(){const e=l(1),s=l(1),i=l(""),n=l(0),m=l(0),f=l(),a=B(),c=l(!1),o=l({});H(()=>{_()}),window.localStorage.getItem("Toast")||($({message:"\u70B9\u51FB\u4E0A\u65B9\u6309\u94AE\u53EF\u5207\u6362\u4FE1\u7BB1\u54E6",icon:"/static/image/smsm.png"}),window.localStorage.setItem("Toast","true"));const _=()=>{a.currentRoute.value.query.number&&(c.value=!0,i.value=a.currentRoute.value.query.number)};return{onClickType:()=>{e.value===1?e.value=2:e.value=1,s.value.getPageList(),n.value++},type:e,key:n,keys:m,typenum:s,onSendSms:()=>{c.value=!0},show:c,closed:()=>{f.value.close()},close:f,number:i,smsContent:o,showSend:_,showSendOpen:(I,p)=>{i.value=I,o.value=p,m.value++,c.value=!0},closeSendSms:()=>{c.value=!1}}}},Le={id:"Sms"};function Ie(e,s,i,n,m,f){const a=h("van-icon"),c=h("van-nav-bar"),o=h("SmsList"),_=h("SendSmsContent"),S=h("van-popup");return r(),u("div",Le,[g(c,{title:"\u77ED\u4FE1","left-text":n.type===1?"\u6536\u4EF6\u7BB1":"\u53D1\u4EF6\u7BB1",onClickLeft:n.onClickType,onClickRight:n.onSendSms},{right:k(()=>[g(a,{name:"plus",size:"18"})]),_:1},8,["left-text","onClickLeft","onClickRight"]),(r(),R(o,{ref:"typenum",key:n.key,type:n.type,onOpenSendContent:n.showSendOpen},null,8,["type","onOpenSendContent"])),g(S,{show:n.show,"onUpdate:show":s[0]||(s[0]=t=>n.show=t),onClosed:n.closed,round:"",position:"bottom",style:{height:"80%"}},{default:k(()=>[(r(),R(_,{onClose:n.closeSendSms,number:n.number,smsContent:n.smsContent,ref:"close",key:n.keys},null,8,["onClose","number","smsContent"]))]),_:1},8,["show","onClosed"])])}var Re=U(be,[["render",Ie],["__scopeId","data-v-75595c7e"]]);export{Re as default};
